{% extends 'partials/base.html' %}
{% load static %}
{% load humanize %}

{% block title %}
<title>{{ subcategory.subcategory_title }} Products - BLUST BY DR MA</title>
{% endblock title %}

{% block extra-css %}
<link rel="stylesheet" href="{% static 'assets/css/product-card.css' %}">
{% endblock extra-css %}

{% block content %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'core:category-list' %}">Categories</a></li>
        <li class="breadcrumb-item"><a href="{% url 'core:subcategory-list' subcategory.category.cid %}">{{ subcategory.category.category_title }}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ subcategory.subcategory_title }}</li>
    </ol>
</nav>

<h2 class="text-center mb-4">{{ subcategory.subcategory_title }} Products ({{products.count}})</h2>
<div class="container">
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
        {% for p in products %}
        <div class="col">
            <article class="card" style="background-color: #E3F8FF;">
                <a href="{% url 'core:product-detail' p.pid %}" class="text-decoration-none text-dark">
                    <div class="card__img">
                        <img src="{{p.product_image.url}}" alt="{{p.product_title}}">
                    </div>
                    <div class="card__name">
                        <p>{{p.product_title}}</p>
                    </div>
                    <div class="card__content">
                        <p class="card__description fw-bolder">{{p.product_title|truncatechars:20}}</p>
                        <p class="card__specification">{{p.specification}}</p>
                        <div class="card__stock {% if p.is_low_stock %}low-stock{% endif %}">
                            {% if p.in_stock %}
                                {% if p.is_low_stock %}
                                    Low Stock: {{p.available_stock}} left
                                {% else %}
                                    In Stock: {{p.available_stock}} available
                                {% endif %}
                            {% else %}
                                Out of Stock
                            {% endif %}
                        </div>
                    </div>
                    <div class="card__precis">
                        <div class="card__price">
                            {% if p.discounted_price < p.normal_price %}
                                <span class="card__preci card__preci--now">sh.{{p.discounted_price|intcomma}}</span>
                                <span class="card__preci card__preci--before">sh.{{p.normal_price|intcomma}}</span>
                                <span class="card__discount">-{{p.get_percent_discount}}%</span>
                            {% else %}
                                <span class="card__preci card__preci--now">sh.{{p.normal_price|intcomma}}</span>
                            {% endif %}
                        </div>
                    </div>
                </a>
                <div class="card__actions">
                    <a href="" class="card__icon" title="Add to wishlist"><ion-icon name="heart-outline"></ion-icon></a>
                    <a href="" class="card__icon" title="Add to cart"><ion-icon name="cart-outline"></ion-icon></a>
                    <a href="" class="card__icon" title="Compare"><ion-icon name="git-compare-outline"></ion-icon></a>
                </div>
            </article>
        </div>
        {% empty %}
        <div class="col-12">
            <p class="text-center">No products found in this subcategory.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock content %}